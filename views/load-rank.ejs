<% var progress = (new Date() - data[0].time_begin) / (data[0].time_end - data[0].time_begin) * 100;
var point = []
for (let i = 0, l = data.length; i < l; ++i) {
    point[data[i].student_rollnumber] = new Array();
    for (let j = 0; j < problem_files.length; ++j) {
       point[data[i].student_rollnumber][problem_files[j].split('-')[0]] = "Not submit";
    }
    
}

for (let i = 0, l = log_files.length; i < l; ++i) {
    rollnum = log_files[i].split('][')[3];
    prob = log_files[i].split('][')[4].split('].')[0];
    var contents = fs.readFileSync('./public/nopbai/Logs/' + data[0].contest_name + '/' + log_files[i], 'utf8');
    if (!contents.split('\n')[0].includes('error')) {
        point[rollnum][prob] = parseInt(contents.split('\n')[0], 10);
    } else {
        point[rollnum][prob] = 0;
    }  
}
var totalpoint = []
for (let i = 0, l = data.length; i < l; ++i) {
    totalpoint[data[i].student_rollnumber] = 0;
    for (let j = 0, l = problem_files.length; j < l; ++j) {
        if (isNaN(point[data[i].student_rollnumber][problem_files[j].split('-')[0]]) == false) {
            totalpoint[data[i].student_rollnumber] += point[data[i].student_rollnumber][problem_files[j].split('-')[0]];
        } else {
            totalpoint[data[i].student_rollnumber] += 0;
        }
    }
}
var obj = {
    data: []
 };
for (let i = 0, l = data.length; i < l; ++i) {
    tb = new Array();
    
    tb.push(data[i].student_rollnumber, data[i].name, data[i].class);
    
    for (let j = 0, l = problem_files.length; j < l; ++j) {
        tb.push(point[data[i].student_rollnumber][problem_files[j].split('-')[0]]); 
    }
    tb.push(totalpoint[data[i].student_rollnumber]);
    tb.push(-1);
    obj.data.push(tb);
}
global.dataajax = obj;
%>
<%- JSON.stringify(dataajax) %>