<%- include ("partials/header") %>
<% 
    var logs = [];
    var bais = [];
    for (let i = 0; i < bailam.length; ++i) {
        for (let j = 0; j < log_files.length; ++j) {
            if (bailam[i].includes(log_files[j].split('.')[0])) {  
                bais.push(bailam[i]);
                logs.push(log_files[j]);
            }
            
        }
    }
%>
<div class="container">
    <div class="bc-icons">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"> <a class="text-gray-700" href="/rank">Rank</a></li>
                <li><i class="fas fa-angle-double-right mx-2 text-gray-700" aria-hidden="true"></i></li>
                <li class="breadcrumb-item"> <a class="text-gray-700"  href="/data-rank?contest_id=<%= contest_id %>"><%= contest_name %></a></li>
                <li><i class="fas fa-angle-double-right mx-2 text-gray-700" aria-hidden="true"></i></li>
                <li class="breadcrumb-item text-gray-700 font-italic"><%= rollnumber %></li>
            </ol>
        </nav>
    </div>
    <div class="accordion md-accordion accordion-1" id="accordionEx1" role="tablist" aria-multiselectable="true">
    <% 
        for (let i = log_files.length - 1; i >= 0; --i) {
            var mtime = fs.statSync(bailam[i]).mtime; 
            var tenbai = bailam[i].split('][')[4].replace('].', '.');
            var filedate = new Date(new Date(mtime).getTime() - (new Date(mtime).getTimezoneOffset() * 60000)).toISOString().substring(0, 19).replace('T',' ');
            var logcontent = fs.readFileSync('./public/nopbai/Logs/' + contest_name + '/' + logs[i], 'utf8');
            var baicontent = fs.readFileSync(bais[i], 'utf8');
            var status = 'success';
            if (logcontent.split('\n')[0].includes('error') || logcontent.split('\n')[0] == "0") {
                status = 'danger';
            }
    %>
    <div class="card shadow mb-1 border-left-<%=status%>">
        <!-- Card Header - Accordion -->
        <a href="#collapseCardExample<%=i%>" class="d-block card-header py-3" data-toggle="collapse" role="tab"
            aria-expanded="true" aria-controls="collapseCardExample" data-parent="#accordionEx1">
            <h6 class="m-0 font-weight-bold text-<%=status%>">
                <%= filedate %> - <%= tenbai %>
            </h6>
        </a>
        <!-- Card Content - Collapse -->
        <div class="collapse" id="collapseCardExample<%=i%>" data-parent="#accordionEx1">
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        Result
                        <div id="editorlog<%=i%>" style="height: 200px;"><%= logcontent %></div>
                    </div>
                    <div class="col">
                        Submission
                        <div id="editorbai<%=i%>" style="height: 200px;"><%= baicontent %></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var editorlog = ace.edit('editorlog<%=i%>');
        editorlog.getSession().setMode("ace/mode/c_cpp");
        document.getElementById('editorlog<%=i%>').style.fontSize = '15px';
        var editorbai = ace.edit('editorbai<%=i%>');
        editorbai.getSession().setMode("ace/mode/c_cpp");
        document.getElementById('editorbai<%=i%>').style.fontSize = '15px';
    </script>
    <% } %>
</div>
</div>
<%- include ("partials/footer") %>