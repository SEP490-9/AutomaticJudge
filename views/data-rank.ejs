<%- include ("partials/header") %>

<div class="container">

    <% if (message.length > 0) { %>
    <div class="alert alert-danger col-sm-12"><%= message %></div>
    <% } else { %>
    <script>
        var datajson;
        var index = [];
        $(document).ready(function () {
            var x = setInterval(function () {
                var pro = (new Date().getTime() - parseInt('<%=data[0].time_begin.getTime()%>')) / (parseInt('<%=data[0].time_end.getTime()%>') - parseInt('<%=data[0].time_begin.getTime()%>')) * 100;

                if (pro <= 100 && pro >= 0) {
                    $('#progress').attr('style', 'width:' + pro + '%');
                    $('#progress').text((pro | 0).toString() + '%');
                } else if (pro > 100) {
                    $('#progress').attr('style', 'width:100%');
                    $('#progress').attr('class', 'progress-bar progress-bar-striped bg-danger');
                    $('#progress').text('The Contest is Over');
                    clearInterval(x);
                    return;
                } else {
                    $('#progress').attr('style', 'width:100%');
                    $('#progress').attr('class', 'progress-bar progress-bar-striped bg-primary');
                    $('#progress').text('The Contest is not open');
                    clearInterval(x);
                    return;
                }

            }, 100);

            var example_table = $('#dataTableRank').DataTable({
                "ajax": "/contest/load-rank?contest_id=<%=data[0].contest_id%>",
                "columnDefs": [{
                    "targets": [0, 1],
                    "render": function (data, type, row, meta) {
                        return '<a href="/contest/detail-rank?rollnumber=' + row[0] + '">' + data + '</a>';
                    }
                }],
                "dom": 'lBfrtip',
                buttons: [{
                    extend: 'excelHtml5',
                    text: '<li class="fa fa-file-excel"></li> Export to Excel',
                    title: '<%=data[0].contest_name%>',

                    download: 'open',
                    orientation: 'landscape',
                    exportOptions: {
                        columns: ':visible'
                    }
                }]
            });
            setInterval(function () {
                example_table.ajax.reload();
            }, 5000);
        });
    </script>
    <div class="bc-icons">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"> <a class="text-gray-700" href="/contest/rank">Rank</a></li>
                <li><i class="fas fa-angle-double-right mx-2 text-gray-700" aria-hidden="true"></i></li>
                <li class="breadcrumb-item text-gray-700 active"><%= data[0].contest_name %></li>
            </ol>
        </nav>
    </div>
    <div class="row">
        <div class="col-md-3 text-left no-pad">
            <h4><b>Start</b></h4>
            <%= data[0].time_begin1 %>
        </div>
        <div class="col-md-6 text-center">
            <h2 class="title">Contest <%= data[0].contest_name %></h2>
        </div>
        <div class="col-md-3 text-right no-pad">
            <h4><b>End</b></h4>
            <%= data[0].time_end1 %>
        </div>
    </div>
    <div class="progress">
        <div id="progress" class="progress-bar progress-bar-striped progress-bar-animated bg-success"></div>
    </div>
    <br />
    <div class="card shadow mb-4">
        <div class="card-body">
            <div class="table-responsive">
                <table id="dataTableRank" class="table table-hover table-bordered" style="width: 100%;">
                    <thead>
                        <tr>
                            <th width="12%">Roll number</th>
                            <th>Name</th>
                            <th width="5%">Class</th>
                            <% for (let i = 0, l = problem_files.length; i < l; ++i) { %>
                            <th width="10%">
                                <center><a href="/debai/<%data[0].contest_name%>/<%=problem_files[i]%>" target="_blank"
                                        data-toggle="tooltip" data-placement="bottom"
                                        title="<%=problem_files[i].split('.')[0]%>"><%= problem_files[i].split('-')[0] %></a>
                                </center>
                            </th>
                            <% } %>
                            <th>
                                <center>Total</center>
                            </th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
    <% } %>
</div>
<%- include ("partials/footer") %>